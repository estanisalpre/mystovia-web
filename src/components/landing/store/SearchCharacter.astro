---
import Input from "@ui/Input.astro";
import SubmitBtn from "@lib/components/ui/SubmitBtn.astro";
import DiamondPattern from "../../ui/DiamondPattern.astro";
import GoldenLine from "../../ui/GoldenLine.astro";
import CornerOrnaments from "../../ui/CornerOrnaments.astro";
---

<section class="relative w-full h-full rounded-xl overflow-hidden"
         style="background: linear-gradient(to bottom, rgb(17 24 39 / 0.98), rgb(17 24 39), rgb(0 0 0 / 0.98));">
  <!-- Diamond pattern overlay -->
  <DiamondPattern opacity={0.03} class="rounded-xl" />

  <!-- Top golden line -->
  <GoldenLine position="top" />

  <!-- Border -->
  <span class="absolute inset-0 rounded-xl border border-yellow-600/20 pointer-events-none" aria-hidden="true"></span>

  <!-- Corner ornaments -->
  <CornerOrnaments variant="curve" size="md" opacity={0.2} offset={2} />

  <!-- Content -->
  <div class="relative z-10 p-5 pt-12">
    <!-- Header badge -->
    <div class="absolute -top-0.5 left-1/2 -translate-x-1/2">
      <div class="relative px-6 py-2 rounded-b-lg" style="background: linear-gradient(to bottom, rgb(234 179 8 / 0.9), rgb(202 138 4 / 0.9));">
        <div class="absolute inset-0 rounded-b-lg border border-yellow-400/30 pointer-events-none"></div>
        <h2 id="searchTitle" class="text-sm font-bold text-black text-center medieval-font relative z-10">Buscar Personaje</h2>
      </div>
    </div>

    <form id="searchCharacterForm" class="flex flex-col md:flex-row items-end gap-4">
      <div class="flex-1 w-full">
        <Input
          id="characterName"
          label="Nombre del personaje"
          type="text"
          placeholder="Ingresa el nombre del personaje"
          required
        />
      </div>
      <div class="w-full md:w-auto mb-4">
        <SubmitBtn label="BUSCAR" id="searchBtn" />
      </div>
    </form>
  </div>
</section>

<script>
    import { t, getStoredLanguage } from '../../../i18n/translations';

    function applyTranslations() {
        const lang = getStoredLanguage();

        const titleEl = document.getElementById('searchTitle');
        if (titleEl) titleEl.textContent = t('character.searchTitle', lang);

        const searchBtn = document.getElementById('searchBtn');
        if (searchBtn) searchBtn.textContent = t('character.searchButton', lang);

        const charNameInput = document.getElementById('characterName') as HTMLInputElement;
        if (charNameInput) {
            charNameInput.placeholder = t('character.searchPlaceholder', lang);
            const label = charNameInput.parentElement?.querySelector('label');
            if (label) label.textContent = t('character.searchLabel', lang);
        }
    }

    function initSearchForm() {
        const lang = getStoredLanguage();
        const form = document.getElementById("searchCharacterForm") as HTMLFormElement & {
            characterName: HTMLInputElement;
        };

        form?.addEventListener("submit", async (e) => {
            e.preventDefault();
            const characterName = form.characterName.value.trim();

            if (!characterName) {
                alert(t('character.searchEmpty', lang));
                return;
            }

            window.location.href = `/character-information?name=${encodeURIComponent(characterName)}`;
        });
    }

    applyTranslations();
    initSearchForm();
    document.addEventListener('astro:page-load', applyTranslations);
</script>

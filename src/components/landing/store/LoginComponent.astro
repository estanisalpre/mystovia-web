---
import Input from "@ui/Input.astro";
import ErrorMessage from "@ui/ErrorMessage.astro";
import SubmitBtn from "@lib/components/ui/SubmitBtn.astro";

let error = "";
---

<form
  id="loginForm"
  class="relative border border-white/30 max-w-[250px] w-full p-2 pt-6 shadow-md rounded-lg backdrop-blur-md bg-black/30"
>
  <h2 class="absolute -translate-x-1/2 -top-5 left-1/2 text-md font-bold text-black text-center p-1 rounded-lg bg-white medieval-font">Ingresar</h2>

  <Input
    id="email"
    label="Correo electrónico"
    type="email"
    placeholder="tu@correo.com"
    required
  />
  <Input
    id="password"
    label="Contraseña"
    type="password"
    placeholder="••••••••"
    required
  />

  <ErrorMessage
    message={error}
    visible={!!error}
  />

  <SubmitBtn label="Login" />

  <p class="text-center text-sm mt-2 text-gray-400">
    ¿No tenes una cuenta? <a
      href="/register"
      class="text-yellow-500 hover:text-yellow-400 font-medium"
      >Registrate</a
    >
  </p>
</form>

<script>
  import { useAuth } from "@hooks/useAuth";

  const form = document.getElementById("loginForm") as HTMLFormElement & {
    email: HTMLInputElement;
    password: HTMLInputElement;
  };

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();
    const email = form.email.value;
    const password = form.password.value;

    const res = await useAuth("login", { email, password });
    if (res.success) window.location.href = "/create-character";
    else alert(res.error);
  });
</script>

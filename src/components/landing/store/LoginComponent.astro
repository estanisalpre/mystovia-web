---
import Input from "@ui/Input.astro";
import ErrorMessage from "@ui/ErrorMessage.astro";
import SubmitBtn from "@lib/components/ui/SubmitBtn.astro";

let error = "";
---

<form
  id="loginForm"
  class="relative w-full h-full rounded-xl overflow-hidden"
  style="background: linear-gradient(to bottom, rgb(17 24 39 / 0.98), rgb(17 24 39), rgb(0 0 0 / 0.98));"
>
  <!-- Diamond pattern overlay -->
  <div class="absolute inset-0 opacity-[0.03] pointer-events-none rounded-xl" style="background-image: url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M30 0L60 30L30 60L0 30z\' fill=\'%23d4af37\' fill-opacity=\'0.4\'/%3E%3C/svg%3E'); background-size: 30px 30px;"></div>

  <!-- Top golden line -->
  <div class="absolute top-0 left-0 right-0 h-0.5 bg-gradient-to-r from-transparent via-yellow-500/50 to-transparent rounded-t-xl"></div>

  <!-- Border -->
  <div class="absolute inset-0 rounded-xl border border-yellow-600/20 pointer-events-none"></div>

  <!-- Corner ornaments -->
  <div class="absolute top-2 left-2 w-5 h-5 opacity-20 pointer-events-none">
    <svg viewBox="0 0 100 100" fill="none" class="w-full h-full text-yellow-500">
      <path d="M0 0 L40 0 Q0 0 0 40 Z" fill="currentColor"/>
    </svg>
  </div>
  <div class="absolute top-2 right-2 w-5 h-5 opacity-20 pointer-events-none" style="transform: scaleX(-1);">
    <svg viewBox="0 0 100 100" fill="none" class="w-full h-full text-yellow-500">
      <path d="M0 0 L40 0 Q0 0 0 40 Z" fill="currentColor"/>
    </svg>
  </div>
  <div class="absolute bottom-2 left-2 w-5 h-5 opacity-20 pointer-events-none" style="transform: scaleY(-1);">
    <svg viewBox="0 0 100 100" fill="none" class="w-full h-full text-yellow-500">
      <path d="M0 0 L40 0 Q0 0 0 40 Z" fill="currentColor"/>
    </svg>
  </div>
  <div class="absolute bottom-2 right-2 w-5 h-5 opacity-20 pointer-events-none" style="transform: scale(-1);">
    <svg viewBox="0 0 100 100" fill="none" class="w-full h-full text-yellow-500">
      <path d="M0 0 L40 0 Q0 0 0 40 Z" fill="currentColor"/>
    </svg>
  </div>

  <!-- Content -->
  <div class="relative z-10 p-5 pt-12">
    <!-- Header badge -->
    <div class="absolute -top-0.5 left-1/2 -translate-x-1/2">
      <div class="relative px-6 py-2 rounded-b-lg" style="background: linear-gradient(to bottom, rgb(234 179 8 / 0.9), rgb(202 138 4 / 0.9));">
        <div class="absolute inset-0 rounded-b-lg border border-yellow-400/30 pointer-events-none"></div>
        <h2 class="text-sm font-bold text-black text-center medieval-font relative z-10">Ingresar</h2>
      </div>
    </div>

    <Input
      id="email"
      label="Correo electrónico"
      type="email"
      placeholder="tu@correo.com"
      required
    />
    <Input
      id="password"
      label="Contraseña"
      type="password"
      placeholder="••••••••"
      required
    />

    <ErrorMessage
      message={error}
      visible={!!error}
    />

    <SubmitBtn label="INGRESAR" />

    <!-- Decorative divider -->
    <div class="flex items-center gap-2 my-3">
      <div class="flex-1 h-px bg-gradient-to-r from-transparent via-yellow-500/20 to-transparent"></div>
      <svg class="w-3 h-3 text-yellow-500/40" fill="currentColor" viewBox="0 0 20 20">
        <path d="M10 0L20 10L10 20L0 10z"/>
      </svg>
      <div class="flex-1 h-px bg-gradient-to-r from-transparent via-yellow-500/20 to-transparent"></div>
    </div>

    <p class="text-center text-sm text-gray-400">
      ¿No tenes una cuenta? <a
        href="/register"
        class="text-yellow-500 hover:text-yellow-400 font-medium transition-colors"
        >Registrate</a
      >
    </p>
  </div>
</form>

<script>
  import { useAuth } from "@hooks/useAuth";

  const form = document.getElementById("loginForm") as HTMLFormElement & {
    email: HTMLInputElement;
    password: HTMLInputElement;
  };

  form?.addEventListener("submit", async (e) => {
    e.preventDefault();
    const email = form.email.value;
    const password = form.password.value;

    const res = await useAuth("login", { email, password });
    if (res.success) window.location.href = "/create-character";
    else alert(res.error);
  });
</script>

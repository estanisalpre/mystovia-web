---
import { MystoviaLogo } from "../../assets/logos";
import { Diamond, Star, Sword, Download, ArrowRight, ShieldCheck, UserPlus, BarChart3 } from '@lucide/astro';
import DiamondPattern from "../ui/DiamondPattern.astro";
import GoldenLine from "../ui/GoldenLine.astro";
import CornerOrnaments from "../ui/CornerOrnaments.astro";

const downloadUrl = import.meta.env.PUBLIC_DOWNLOAD_URL || "https://github.com/estanisalpre/mystovia-web/releases/download/v.0.0.2/MystoviaLauncher.exe";
---

<section id="download-section" class="flex justify-start items-center pt-32 flex-col relative py-20">
  <!-- Decorative elements -->
  <div class="absolute top-20 left-1/2 -translate-x-1/2 w-full max-w-4xl h-px bg-gradient-to-r from-transparent via-yellow-500/20 to-transparent z-40"></div>

  <!-- Welcome text with medieval style -->
  <header class="relative z-50 mb-4">
    <figure class="flex items-center justify-center gap-3 mb-2" aria-hidden="true">
      <span class="h-px w-12 bg-gradient-to-r from-transparent to-yellow-500/50"></span>
      <Diamond class="w-4 h-4 text-yellow-500/70 animate-pulse" fill="currentColor" />
      <span class="h-px w-12 bg-gradient-to-l from-transparent to-yellow-500/50"></span>
    </figure>
    <p id="heroWelcome" class="text-yellow-500/80 text-lg medieval-font tracking-widest uppercase text-center">Bienvenidos a</p>
  </header>

  <!-- Logo with celebration glow -->
  <h1 class="z-50 mb-6 animate-logo-glow">
    <img
      src={MystoviaLogo.src}
      alt="Mystovia Logo Header"
      class="w-80 md:w-[450px] h-auto drop-shadow-[0_0_30px_rgba(234,179,8,0.3)]"
    />
  </h1>

  <!-- Grand Opening Celebration Box -->
  <article class="relative z-50 mb-8 max-w-4xl mx-4">
    <div class="relative rounded-2xl overflow-hidden p-8 md:p-12 text-center animate-fade-in-up"
         style="background: linear-gradient(to bottom, rgb(17 24 39 / 0.95), rgb(0 0 0 / 0.9)); box-shadow: 0 0 80px rgba(234, 179, 8, 0.25), inset 0 1px 0 rgba(234, 179, 8, 0.1);">

      <!-- Animated celebration glow effect -->
      <div class="absolute inset-0 opacity-30 pointer-events-none animate-pulse-glow" style="background: radial-gradient(ellipse at center, rgba(234, 179, 8, 0.4) 0%, transparent 70%);"></div>

      <!-- Diamond pattern overlay -->
      <DiamondPattern opacity={0.04} />

      <!-- Top and bottom golden lines -->
      <GoldenLine position="top" thickness="thick" opacity={0.8} animate />
      <GoldenLine position="bottom" thickness="thick" opacity={0.8} animate />

      <!-- Border with glow -->
      <span class="absolute inset-0 rounded-2xl border-2 border-yellow-500/40 pointer-events-none" aria-hidden="true"></span>

      <!-- Corner ornaments -->
      <CornerOrnaments variant="bracket" size="xl" opacity={0.5} animate offset={3} />

      <!-- Sword decorations on sides -->
      <figure class="absolute left-6 top-1/2 -translate-y-1/2 opacity-25 hidden md:block animate-float" aria-hidden="true">
        <Sword class="w-8 h-28 text-yellow-500" />
      </figure>
      <figure class="absolute right-6 top-1/2 -translate-y-1/2 opacity-25 hidden md:block animate-float-delayed" aria-hidden="true">
        <Sword class="w-8 h-28 text-yellow-500" />
      </figure>

      <!-- Content -->
      <div class="relative z-10">
        <!-- Celebration stars -->
        <figure class="flex items-center justify-center gap-2 mb-4" aria-hidden="true">
          <Star class="w-5 h-5 text-yellow-400 animate-twinkle" fill="currentColor" />
          <Star class="w-6 h-6 text-yellow-500 animate-twinkle-delayed" fill="currentColor" />
          <Star class="w-8 h-8 text-yellow-400 animate-bounce-slow" fill="currentColor" />
          <Star class="w-6 h-6 text-yellow-500 animate-twinkle-delayed" fill="currentColor" />
          <Star class="w-5 h-5 text-yellow-400 animate-twinkle" fill="currentColor" />
        </figure>

        <!-- Main celebration title -->
        <h2 id="heroKingdomOpen" class="text-3xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 via-yellow-500 to-yellow-400 medieval-font tracking-wider uppercase mb-4 animate-text-glow">
          ¡El Reino Está Abierto!
        </h2>

        <!-- Subtitle -->
        <p id="heroAdventureBegins" class="text-xl md:text-2xl text-yellow-500/90 medieval-font mb-2 animate-fade-in">
          ¡La aventura comienza ahora!
        </p>

        <p id="heroKingdomDescription" class="text-gray-400 text-base md:text-lg mb-8 max-w-xl mx-auto">
          Las puertas de Mystovia se han abierto. Es hora de forjar tu leyenda, guerrero.
          ¡Únete a miles de aventureros que ya están explorando el reino!
        </p>

        <!-- Divider -->
        <figure class="flex items-center justify-center gap-3 mb-8" aria-hidden="true">
          <span class="h-px w-24 bg-gradient-to-r from-transparent to-yellow-500/50"></span>
          <Diamond class="w-5 h-5 text-yellow-500/60 animate-spin-slow" fill="currentColor" />
          <span class="h-px w-24 bg-gradient-to-l from-transparent to-yellow-500/50"></span>
        </figure>

        <!-- BIG Download Button -->
        <a
          href={downloadUrl}
          download="MystoviaLauncher.exe"
          class="group relative inline-flex items-center gap-4 px-12 py-6 bg-gradient-to-b from-yellow-500 via-yellow-600 to-yellow-700 hover:from-yellow-400 hover:via-yellow-500 hover:to-yellow-600 text-black font-bold text-xl md:text-2xl rounded-xl transition-all duration-300 transform hover:scale-105 border-2 border-yellow-400/60 shadow-[0_0_40px_rgba(234,179,8,0.4)] hover:shadow-[0_0_60px_rgba(234,179,8,0.6)] animate-button-pulse"
        >
          <!-- Button glow effect -->
          <span class="absolute inset-0 rounded-xl bg-gradient-to-t from-transparent via-white/10 to-white/20 pointer-events-none" aria-hidden="true"></span>

          <!-- Download icon -->
          <Download class="w-8 h-8 transition-transform group-hover:translate-y-1" />

          <span id="heroDownloadBtn" class="medieval-font tracking-wide relative z-10">DESCARGAR CLIENTE</span>

          <!-- Arrow indicator -->
          <ArrowRight class="w-6 h-6 transition-transform group-hover:translate-x-1" />
        </a>

        <!-- Secondary info -->
        <p class="text-gray-500 text-sm mt-4 flex items-center justify-center gap-2">
          <ShieldCheck class="w-4 h-4" />
          <span id="heroWindowsInstall">Windows 10/11 - Instalación rápida y segura</span>
        </p>
      </div>
    </div>
  </article>

  <!-- Tagline with medieval container -->
  <article class="relative z-50 mb-8 max-w-2xl mx-4">
    <div class="relative rounded-xl overflow-hidden p-6 text-center"
         style="background: linear-gradient(to bottom, rgb(17 24 39 / 0.9), rgb(0 0 0 / 0.85));">
      <!-- Diamond pattern overlay -->
      <DiamondPattern opacity={0.03} />

      <!-- Top golden line -->
      <GoldenLine position="top" />

      <!-- Border -->
      <span class="absolute inset-0 rounded-xl border border-yellow-600/20 pointer-events-none" aria-hidden="true"></span>

      <!-- Corner ornaments -->
      <CornerOrnaments variant="curve" size="sm" opacity={0.3} />

      <!-- Content -->
      <div class="relative z-10">
        <h2 id="heroTagline" class="text-2xl md:text-3xl font-bold text-yellow-500 medieval-font mb-3">
          Forja tu leyenda
        </h2>
        <figure class="flex items-center justify-center gap-3 mb-3" aria-hidden="true">
          <span class="h-px w-16 bg-gradient-to-r from-transparent to-yellow-500/40"></span>
          <Diamond class="w-3 h-3 text-yellow-500/50" fill="currentColor" />
          <span class="h-px w-16 bg-gradient-to-l from-transparent to-yellow-500/40"></span>
        </figure>
        <p id="heroDescription" class="text-gray-300 text-lg leading-relaxed">
          Un reino clásico donde cada batalla cuenta,<br class="hidden sm:block"/>
          los peligros son reales y las recompensas, únicas.
        </p>
      </div>
    </div>
  </article>

  <!-- CTA Buttons -->
  <nav class="flex z-50 flex-col sm:flex-row gap-4 justify-center px-6 sm:px-0" aria-label="Acciones principales">
    <a
      href="/register"
      class="btn-medieval btn-medieval-primary btn-medieval-lg"
    >
      <UserPlus class="w-5 h-5" />
      <span id="heroCreateAccount">Crear cuenta</span>
    </a>
    <a
      href="/highscores"
      class="btn-medieval btn-medieval-secondary btn-medieval-lg"
    >
      <BarChart3 class="w-5 h-5" />
      <span id="heroViewHighscores">Ver Highscores</span>
    </a>
  </nav>

  <!-- Bottom decorative line -->
  <span class="absolute bottom-10 left-1/2 -translate-x-1/2 w-full max-w-4xl h-px bg-gradient-to-r from-transparent via-yellow-500/20 to-transparent z-40" aria-hidden="true"></span>
</section>

<style>
  /* Celebration animations */
  @keyframes fade-in-up {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes pulse-glow {
    0%, 100% { opacity: 0.2; }
    50% { opacity: 0.4; }
  }

  @keyframes shimmer {
    0% { opacity: 0.5; }
    50% { opacity: 1; }
    100% { opacity: 0.5; }
  }

  @keyframes corner-glow {
    0%, 100% { opacity: 0.4; }
    50% { opacity: 0.7; }
  }

  @keyframes float {
    0%, 100% { transform: translateY(-50%) translateX(0); }
    50% { transform: translateY(-50%) translateX(-5px); }
  }

  @keyframes float-delayed {
    0%, 100% { transform: translateY(-50%) translateX(0); }
    50% { transform: translateY(-50%) translateX(5px); }
  }

  @keyframes twinkle {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(0.8); }
  }

  @keyframes twinkle-delayed {
    0%, 100% { opacity: 0.6; transform: scale(0.9); }
    50% { opacity: 1; transform: scale(1.1); }
  }

  @keyframes bounce-slow {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-8px); }
  }

  @keyframes spin-slow {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  @keyframes text-glow {
    0%, 100% {
      filter: drop-shadow(0 0 20px rgba(234, 179, 8, 0.5));
    }
    50% {
      filter: drop-shadow(0 0 40px rgba(234, 179, 8, 0.8));
    }
  }

  @keyframes button-pulse {
    0%, 100% {
      box-shadow: 0 0 40px rgba(234, 179, 8, 0.4);
    }
    50% {
      box-shadow: 0 0 60px rgba(234, 179, 8, 0.6);
    }
  }

  @keyframes logo-glow {
    0%, 100% {
      filter: drop-shadow(0 0 30px rgba(234, 179, 8, 0.3));
    }
    50% {
      filter: drop-shadow(0 0 50px rgba(234, 179, 8, 0.5));
    }
  }

  @keyframes particle-fall {
    0% {
      transform: translateY(-100%) rotate(0deg);
      opacity: 1;
    }
    100% {
      transform: translateY(100vh) rotate(720deg);
      opacity: 0;
    }
  }

  .animate-fade-in-up {
    animation: fade-in-up 0.8s ease-out forwards;
  }

  .animate-fade-in {
    animation: fade-in 1s ease-out forwards;
  }

  .animate-pulse-glow {
    animation: pulse-glow 3s ease-in-out infinite;
  }

  .animate-shimmer {
    animation: shimmer 2s ease-in-out infinite;
  }

  .animate-corner-glow {
    animation: corner-glow 2s ease-in-out infinite;
  }

  .animate-float {
    animation: float 3s ease-in-out infinite;
  }

  .animate-float-delayed {
    animation: float-delayed 3s ease-in-out infinite;
    animation-delay: 1.5s;
  }

  .animate-twinkle {
    animation: twinkle 2s ease-in-out infinite;
  }

  .animate-twinkle-delayed {
    animation: twinkle-delayed 2s ease-in-out infinite;
    animation-delay: 0.5s;
  }

  .animate-bounce-slow {
    animation: bounce-slow 2s ease-in-out infinite;
  }

  .animate-spin-slow {
    animation: spin-slow 8s linear infinite;
  }

  .animate-text-glow {
    animation: text-glow 3s ease-in-out infinite;
  }

  .animate-button-pulse {
    animation: button-pulse 2s ease-in-out infinite;
  }

  .animate-logo-glow {
    animation: logo-glow 4s ease-in-out infinite;
  }

  .particle {
    position: absolute;
    pointer-events: none;
    animation: particle-fall linear forwards;
  }
</style>

<script>
  import { t, getStoredLanguage } from '../../i18n/translations';

  function applyTranslations() {
    const lang = getStoredLanguage();

    const heroWelcome = document.getElementById('heroWelcome');
    if (heroWelcome) heroWelcome.textContent = t('hero.welcome', lang);

    const heroKingdomOpen = document.getElementById('heroKingdomOpen');
    if (heroKingdomOpen) heroKingdomOpen.textContent = t('hero.kingdomOpen', lang);

    const heroAdventureBegins = document.getElementById('heroAdventureBegins');
    if (heroAdventureBegins) heroAdventureBegins.textContent = t('hero.adventureBegins', lang);

    const heroKingdomDescription = document.getElementById('heroKingdomDescription');
    if (heroKingdomDescription) heroKingdomDescription.textContent = t('hero.kingdomDescription', lang);

    const heroDownloadBtn = document.getElementById('heroDownloadBtn');
    if (heroDownloadBtn) heroDownloadBtn.textContent = t('hero.downloadClient', lang);

    const heroWindowsInstall = document.getElementById('heroWindowsInstall');
    if (heroWindowsInstall) heroWindowsInstall.textContent = t('hero.windowsInstall', lang);

    const heroTagline = document.getElementById('heroTagline');
    if (heroTagline) heroTagline.textContent = t('hero.tagline', lang);

    const heroDescription = document.getElementById('heroDescription');
    if (heroDescription) heroDescription.textContent = t('hero.description', lang);

    const heroCreateAccount = document.getElementById('heroCreateAccount');
    if (heroCreateAccount) heroCreateAccount.textContent = t('hero.createAccount', lang);

    const heroViewHighscores = document.getElementById('heroViewHighscores');
    if (heroViewHighscores) heroViewHighscores.textContent = t('hero.viewHighscores', lang);
  }

  applyTranslations();
  document.addEventListener('astro:page-load', applyTranslations);

  // Create celebration particles
  function createParticles() {
    const container = document.getElementById('celebration-particles');
    if (!container) return;

    const colors = ['#fbbf24', '#f59e0b', '#d97706', '#fcd34d', '#fef3c7'];
    const shapes = ['◆', '★', '✦', '⬥', '✧'];

    // Create initial burst of particles
    for (let i = 0; i < 30; i++) {
      setTimeout(() => {
        createParticle(container, colors, shapes);
      }, i * 100);
    }

    // Continue creating particles periodically
    setInterval(() => {
      createParticle(container, colors, shapes);
    }, 500);
  }

  function createParticle(container: HTMLElement, colors: string[], shapes: string[]) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.textContent = shapes[Math.floor(Math.random() * shapes.length)];
    particle.style.left = Math.random() * 100 + '%';
    particle.style.top = '-20px';
    particle.style.fontSize = (Math.random() * 16 + 10) + 'px';
    particle.style.color = colors[Math.floor(Math.random() * colors.length)];
    particle.style.animationDuration = (Math.random() * 3 + 4) + 's';
    particle.style.opacity = (Math.random() * 0.5 + 0.3).toString();

    container.appendChild(particle);

    // Remove particle after animation
    setTimeout(() => {
      particle.remove();
    }, 7000);
  }

  // Start particles when page loads
  document.addEventListener('DOMContentLoaded', createParticles);

  // Also run immediately in case DOMContentLoaded already fired
  if (document.readyState === 'complete' || document.readyState === 'interactive') {
    createParticles();
  }
</script>

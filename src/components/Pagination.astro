---
interface Props {
  currentPage: number;
  totalPages: number;
  baseUrl: string;
}

const { currentPage, totalPages, baseUrl } = Astro.props;

// Generar URL con parámetros
function getPageUrl(page: number) {
  const url = new URL(baseUrl, Astro.url);
  url.searchParams.set('page', page.toString());
  return url.pathname + url.search;
}

// Generar array de páginas a mostrar con su tipo
interface PageItem {
  type: 'page' | 'ellipsis';
  page?: number;
}

const pageItems: PageItem[] = [];
for (let i = 1; i <= totalPages; i++) {
  const shouldShow = i === 1 ||
                     i === totalPages ||
                     (i >= currentPage - 2 && i <= currentPage + 2);
  const isEllipsis = i === currentPage - 3 || i === currentPage + 3;

  if (shouldShow) {
    pageItems.push({ type: 'page', page: i });
  } else if (isEllipsis) {
    pageItems.push({ type: 'ellipsis' });
  }
}
---

{totalPages > 1 && (
  <div class="flex justify-center items-center gap-2 mt-8">
    {currentPage > 1 && (
      <a href={getPageUrl(currentPage - 1)} class="btn btn-outline">
        ← Anterior
      </a>
    )}

    <div class="flex gap-1">
      {pageItems.map((item) => {
        if (item.type === 'page' && item.page) {
          return (
            <a
              href={getPageUrl(item.page)}
              class={item.page === currentPage ? 'btn btn-sm btn-primary' : 'btn btn-sm btn-ghost'}
            >
              {item.page}
            </a>
          );
        } else {
          return <span class="px-2">...</span>;
        }
      })}
    </div>

    {currentPage < totalPages && (
      <a href={getPageUrl(currentPage + 1)} class="btn btn-outline">
        Siguiente →
      </a>
    )}
  </div>
)}

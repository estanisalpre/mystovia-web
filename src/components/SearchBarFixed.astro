---
import { Search, Bot, Radio } from "@lucide/astro";
---

<header class="hidden md:block fixed top-[60px] left-0 right-0 z-800 h-[50px]">
  <div class="w-full h-full flex items-center justify-center px-4"
       style="background: linear-gradient(to bottom, rgb(17 24 39 / 0.95), rgb(17 24 39 / 0.9)); border-bottom: 1px solid rgb(234 179 8 / 0.15);">
    <!-- Diamond pattern overlay -->
    <div class="absolute inset-0 opacity-[0.02] pointer-events-none" style="background-image: url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M30 0L60 30L30 60L0 30z\' fill=\'%23d4af37\' fill-opacity=\'0.4\'/%3E%3C/svg%3E'); background-size: 30px 30px;"></div>
    <!-- Bottom golden line -->
    <div class="absolute bottom-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-yellow-500/30 to-transparent"></div>

    <!-- Live Streams + Search Form + Bot Guide Button -->
    <div class="relative z-10 flex items-center gap-4 w-full mt-2 max-w-[60%]">
      <!-- Live Streams Button -->
      <a
        href="/streams"
        id="liveStreamsBtn"
        class="twitch-btn flex items-center gap-2 h-[34px] px-4 text-sm font-semibold rounded-lg transition-all whitespace-nowrap"
        title="Streams en Vivo"
      >
        <Radio class="w-4 h-4" />
        <span id="liveStreamsText" class="hidden lg:inline">En Vivo</span>
      </a>

      <form id="fixedSearchForm" class="flex-1 flex items-center gap-3">
        <div class="flex-1 relative">
          <input
            type="text"
            id="fixedCharacterName"
            placeholder="Buscar personaje..."
            class="w-full h-[34px] px-4 pr-10 text-sm bg-gray-800/60 border border-yellow-600/20 rounded-lg focus:outline-none focus:border-yellow-500/50 text-white placeholder-gray-500 transition-colors"
          />
          <Search class="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500" />
        </div>
        <button
          type="submit"
          id="fixedSearchBtn"
          class="h-[34px] px-5 text-sm font-semibold bg-gradient-to-r from-yellow-600 to-yellow-500 hover:from-yellow-500 hover:to-yellow-400 text-black rounded-lg transition-all border border-yellow-400/30 whitespace-nowrap"
        >
          Buscar
        </button>
      </form>

      <!-- Bot Guide Button -->
      <a
        href="/guides"
        class="flex items-center gap-2 h-[34px] px-4 text-sm font-semibold bg-purple-600/20 hover:bg-purple-600/30 text-purple-300 hover:text-purple-200 rounded-lg transition-all border border-purple-500/30 hover:border-purple-500/50 whitespace-nowrap"
        title="Guías de configuración del Bot"
      >
        <Bot class="w-4 h-4" />
        <span class="hidden lg:inline">Config. Bot</span>
      </a>

      <!-- Connect Twitch Button -->
      <a
        href="/account-management"
        id="connectTwitchBtn"
        class="twitch-btn flex items-center gap-2 h-[34px] px-4 text-sm font-semibold rounded-lg transition-all whitespace-nowrap"
        title="Conectar Twitch"
      >
        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
          <path d="M11.571 4.714h1.715v5.143H11.57zm4.715 0H18v5.143h-1.714zM6 0L1.714 4.286v15.428h5.143V24l4.286-4.286h3.428L22.286 12V0zm14.571 11.143l-3.428 3.428h-3.429l-3 3v-3H6.857V1.714h13.714Z"/>
        </svg>
        <span id="connectTwitchText" class="hidden lg:inline">Conectar Twitch</span>
      </a>
    </div>
  </div>
</header>

<script>
  import { t, getStoredLanguage } from '../i18n/translations';

  function applyTranslations() {
    const lang = getStoredLanguage();

    const fixedInput = document.getElementById('fixedCharacterName') as HTMLInputElement;
    if (fixedInput) {
      fixedInput.placeholder = t('character.searchPlaceholder', lang) || 'Buscar personaje...';
    }

    const fixedSearchBtn = document.getElementById('fixedSearchBtn');
    if (fixedSearchBtn) {
      fixedSearchBtn.textContent = t('common.search', lang);
    }

    const liveStreamsBtn = document.getElementById('liveStreamsBtn');
    if (liveStreamsBtn) {
      liveStreamsBtn.setAttribute('title', t('footer.streams', lang) || 'Streams en Vivo');
    }

    const liveStreamsText = document.getElementById('liveStreamsText');
    if (liveStreamsText) {
      liveStreamsText.textContent = t('nav.streams', lang) || 'En Vivo';
    }

    const connectTwitchBtn = document.getElementById('connectTwitchBtn');
    if (connectTwitchBtn) {
      connectTwitchBtn.setAttribute('title', t('footer.connectTwitch', lang) || 'Conectar Twitch');
    }

    const connectTwitchText = document.getElementById('connectTwitchText');
    if (connectTwitchText) {
      connectTwitchText.textContent = t('footer.connectTwitch', lang) || 'Conectar Twitch';
    }
  }

  function initSearchForm() {
    const fixedForm = document.getElementById('fixedSearchForm') as HTMLFormElement;
    fixedForm?.addEventListener('submit', (e) => {
      e.preventDefault();
      const input = document.getElementById('fixedCharacterName') as HTMLInputElement;
      const name = input?.value.trim();

      if (!name) {
        return;
      }

      window.location.href = `/character-information?name=${encodeURIComponent(name)}`;
    });
  }

  function init() {
    applyTranslations();
    initSearchForm();
  }

  init();
  document.addEventListener('astro:page-load', init);
</script>

<style>
  .twitch-btn {
    background: linear-gradient(to bottom, rgb(147 51 234 / 0.2), rgb(126 34 206 / 0.25));
    border: 1px solid rgb(147 51 234 / 0.4);
    color: rgb(192 132 252);
  }

  .twitch-btn:hover {
    background: linear-gradient(to bottom, rgb(147 51 234 / 0.35), rgb(126 34 206 / 0.4));
    border-color: rgb(147 51 234 / 0.7);
    box-shadow: 0 0 15px rgb(147 51 234 / 0.4);
    color: rgb(216 180 254);
    transform: translateY(-1px);
  }
</style>

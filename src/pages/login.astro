---
import Layout from "../layouts/Layout.astro";
import Input from "@ui/Input.astro";
import ErrorMessage from "@ui/ErrorMessage.astro";
import SubmitBtn from "@ui/SubmitBtn.astro";

let error = "";
---

<Layout title="Ingreso | Mystovia">
  <section class="grow z-100 flex items-center justify-center min-h-screen py-12 px-4">
    <form
      id="loginForm"
      class="max-w-md w-full backdrop-blur-md border border-white/30 bg-black/30 rounded-lg shadow-xl p-8 space-y-6"
    >
      <h2 class="text-3xl font-bold text-center mb-6">Login</h2>

      <Input
        id="email"
        label="Email"
        type="email"
        placeholder="you@email.com"
        required
      />
      <Input
        id="password"
        label="Password"
        type="password"
        placeholder="••••••••"
        required
      />

      <ErrorMessage
        message={error}
        visible={!!error}
      />

      <SubmitBtn label="Login" />

      <p class="text-center text-sm text-gray-400">
        ¿No tenes cuenta aún? <a
          href="/register"
          class="text-yellow-500 hover:text-yellow-400 font-medium"
          >Registrate</a
        >
      </p>
    </form>
  </section>

  <script>
    import { useAuth } from "@hooks/useAuth";

    const form = document.getElementById("loginForm") as HTMLFormElement & {
      email: HTMLInputElement;
      password: HTMLInputElement;
    };

    form?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = form.email.value;
      const password = form.password.value;

      const res = await useAuth("login", { email, password });
      if (res.success) window.location.href = "/create-character";
      else alert(res.error);
    });
  </script>
</Layout>

---
import Layout from "../layouts/Layout.astro";
import Input from "@ui/Input.astro";
import ErrorMessage from "@ui/ErrorMessage.astro";
import SubmitBtn from "@ui/SubmitBtn.astro";

let error = "";
---

<Layout title="Ingreso | Mystovia">
  <section class="grow z-100 flex items-center justify-center min-h-screen py-12 px-4">
    <form
      id="loginForm"
      class="max-w-md w-full backdrop-blur-md border border-white/30 bg-black/30 rounded-lg shadow-xl p-8 space-y-6"
    >
      <h2 id="loginTitle" class="text-3xl font-bold text-center mb-6">Iniciar sesión</h2>

      <Input
        id="email"
        label="Email o Account number"
        type="text"
        placeholder="you@email.com o account number"
        required
      />
      <Input
        id="password"
        label="Password"
        type="password"
        placeholder="••••••••"
        required
      />

      <div class="text-right -mt-4">
        <a
          href="/forgot-password"
          id="forgotPasswordLink"
          class="text-sm text-yellow-500 hover:text-yellow-400 transition-colors"
        >
          ¿Olvidaste tu contraseña?
        </a>
      </div>

      <ErrorMessage
        message={error}
        visible={!!error}
      />

      <SubmitBtn label="INICIAR SESIÓN" id="loginBtn" />

      <p id="noAccountText" class="text-center text-sm text-gray-400">
        ¿No tenes cuenta aún? <a
          href="/register"
          id="registerLink"
          class="text-yellow-500 hover:text-yellow-400 font-medium"
          >Registrate</a
        >
      </p>

      <!-- Lost Account Link -->
      <div class="pt-4 border-t border-gray-700">
        <a
          href="/lost-account"
          id="lostAccountLink"
          class="flex items-center justify-center gap-2 text-sm text-gray-400 hover:text-yellow-500 transition-colors"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <span>Lost Account?</span>
        </a>
      </div>
    </form>
  </section>

  <script>
    import { useAuth } from "@hooks/useAuth";
    import { t, getStoredLanguage } from "../i18n/translations";

    const lang = getStoredLanguage();

    // Apply translations
    const loginTitle = document.getElementById("loginTitle");
    if (loginTitle) loginTitle.textContent = t("auth.login", lang);

    const loginBtn = document.getElementById("loginBtn");
    if (loginBtn) loginBtn.textContent = t("auth.loginButton", lang);

    const noAccountText = document.getElementById("noAccountText");
    const registerLink = document.getElementById("registerLink");
    if (noAccountText && registerLink) {
      noAccountText.childNodes[0].textContent = t("auth.noAccount", lang) + " ";
      registerLink.textContent = t("auth.register", lang);
    }

    const forgotPasswordLink = document.getElementById("forgotPasswordLink");
    if (forgotPasswordLink) forgotPasswordLink.textContent = t("auth.forgotPasswordLink", lang);

    const lostAccountLink = document.getElementById("lostAccountLink");
    if (lostAccountLink) {
      const span = lostAccountLink.querySelector("span");
      if (span) span.textContent = t("auth.lostAccount", lang);
    }

    const form = document.getElementById("loginForm") as HTMLFormElement & {
      email: HTMLInputElement;
      password: HTMLInputElement;
    };

    form?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = form.email.value;
      const password = form.password.value;

      const res = await useAuth("login", { email, password });
      if (res.success) window.location.href = "/create-character";
      else alert(res.error);
    });
  </script>
</Layout>

---
import Layout from "../layouts/Layout.astro";
import Input from "@ui/Input.astro";
import ErrorMessage from "@ui/ErrorMessage.astro";
import SubmitBtn from "@ui/SubmitBtn.astro";

let error = "";
---

<Layout title="Ingreso | Mystovia">
  <section class="grow z-100 flex items-center justify-center min-h-screen py-12 px-4">
    <div class="relative max-w-md w-full overflow-hidden">
      <!-- Medieval container background -->
      <div class="absolute inset-0 rounded-xl bg-gradient-to-b from-gray-900/95 via-gray-900/98 to-black/95 border border-yellow-600/20"></div>

      <!-- Top golden line -->
      <div class="absolute top-0 left-0 right-0 h-0.5 bg-gradient-to-r from-transparent via-yellow-500/50 to-transparent"></div>

      <!-- Diamond pattern overlay -->
      <div class="absolute inset-0 opacity-[0.03] pointer-events-none rounded-xl" style="background-image: url('data:image/svg+xml,%3Csvg width=\'60\' height=\'60\' viewBox=\'0 0 60 60\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cpath d=\'M30 0L60 30L30 60L0 30z\' fill=\'%23d4af37\' fill-opacity=\'0.4\'/%3E%3C/svg%3E'); background-size: 30px 30px;"></div>

      <!-- Corner ornaments -->
      <div class="absolute top-2 left-2 w-8 h-8 opacity-20 pointer-events-none">
        <svg viewBox="0 0 100 100" fill="none" class="w-full h-full text-yellow-500">
          <path d="M0 0 L40 0 Q0 0 0 40 Z" fill="currentColor"/>
        </svg>
      </div>
      <div class="absolute top-2 right-2 w-8 h-8 opacity-20 pointer-events-none" style="transform: scaleX(-1);">
        <svg viewBox="0 0 100 100" fill="none" class="w-full h-full text-yellow-500">
          <path d="M0 0 L40 0 Q0 0 0 40 Z" fill="currentColor"/>
        </svg>
      </div>
      <div class="absolute bottom-2 left-2 w-8 h-8 opacity-20 pointer-events-none" style="transform: scaleY(-1);">
        <svg viewBox="0 0 100 100" fill="none" class="w-full h-full text-yellow-500">
          <path d="M0 0 L40 0 Q0 0 0 40 Z" fill="currentColor"/>
        </svg>
      </div>
      <div class="absolute bottom-2 right-2 w-8 h-8 opacity-20 pointer-events-none" style="transform: scale(-1);">
        <svg viewBox="0 0 100 100" fill="none" class="w-full h-full text-yellow-500">
          <path d="M0 0 L40 0 Q0 0 0 40 Z" fill="currentColor"/>
        </svg>
      </div>

      <!-- Form content -->
      <form
        id="loginForm"
        class="relative z-10 p-8 space-y-6"
      >
        <!-- Title with decorative elements -->
        <div class="text-center mb-8">
          <div class="flex items-center justify-center gap-3 mb-2">
            <div class="h-px w-12 bg-gradient-to-r from-transparent to-yellow-500/50"></div>
            <svg class="w-5 h-5 text-yellow-500/60" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
            </svg>
            <div class="h-px w-12 bg-gradient-to-l from-transparent to-yellow-500/50"></div>
          </div>
          <h2 id="loginTitle" class="text-3xl font-bold text-white medieval-font">Iniciar sesión</h2>
        </div>

        <Input
          id="email"
          label="Email o Account number"
          type="text"
          placeholder="you@email.com o account number"
          required
        />
        <Input
          id="password"
          label="Password"
          type="password"
          placeholder="••••••••"
          required
        />

        <div class="text-right -mt-4">
          <a
            href="/forgot-password"
            id="forgotPasswordLink"
            class="text-sm text-yellow-500 hover:text-yellow-400 transition-colors"
          >
            ¿Olvidaste tu contraseña?
          </a>
        </div>

        <ErrorMessage
          message={error}
          visible={!!error}
        />

        <SubmitBtn label="INICIAR SESIÓN" id="loginBtn" />

        <p id="noAccountText" class="text-center text-sm text-gray-400">
          ¿No tenes cuenta aún? <a
            href="/register"
            id="registerLink"
            class="text-yellow-500 hover:text-yellow-400 font-medium"
            >Registrate</a
          >
        </p>

        <!-- Decorative divider -->
        <div class="flex items-center gap-3 pt-2">
          <div class="flex-1 h-px bg-gradient-to-r from-transparent via-gray-700 to-transparent"></div>
        </div>

        <!-- Lost Account Link -->
        <div class="pt-2">
          <a
            href="/lost-account"
            id="lostAccountLink"
            class="flex items-center justify-center gap-2 text-sm text-gray-400 hover:text-yellow-500 transition-colors"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span>Lost Account?</span>
          </a>
        </div>
      </form>
    </div>
  </section>

  <script>
    import { useAuth } from "@hooks/useAuth";
    import { t, getStoredLanguage } from "../i18n/translations";

    const lang = getStoredLanguage();

    // Apply translations
    const loginTitle = document.getElementById("loginTitle");
    if (loginTitle) loginTitle.textContent = t("auth.login", lang);

    const loginBtn = document.getElementById("loginBtn");
    if (loginBtn) loginBtn.textContent = t("auth.loginButton", lang);

    const noAccountText = document.getElementById("noAccountText");
    const registerLink = document.getElementById("registerLink");
    if (noAccountText && registerLink) {
      noAccountText.childNodes[0].textContent = t("auth.noAccount", lang) + " ";
      registerLink.textContent = t("auth.register", lang);
    }

    const forgotPasswordLink = document.getElementById("forgotPasswordLink");
    if (forgotPasswordLink) forgotPasswordLink.textContent = t("auth.forgotPasswordLink", lang);

    const lostAccountLink = document.getElementById("lostAccountLink");
    if (lostAccountLink) {
      const span = lostAccountLink.querySelector("span");
      if (span) span.textContent = t("auth.lostAccount", lang);
    }

    const form = document.getElementById("loginForm") as HTMLFormElement & {
      email: HTMLInputElement;
      password: HTMLInputElement;
    };

    form?.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = form.email.value;
      const password = form.password.value;

      const res = await useAuth("login", { email, password });
      if (res.success) window.location.href = "/create-character";
      else alert(res.error);
    });
  </script>
</Layout>

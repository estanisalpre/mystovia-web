---
import Layout from "../layouts/Layout.astro";

import Input from "@ui/Input.astro";
import ErrorMessage from "@ui/ErrorMessage.astro";
import SubmitBtn from "@ui/SubmitBtn.astro";

let error = "";
---

<Layout title="Registrarse | Mystovia">
  <section
    class="grow z-100 flex items-center justify-center min-h-screen py-12 px-4"
  >
    <form
      id="registerForm"
      class="max-w-md w-full backdrop-blur-md border border-white/30 bg-black/30 rounded-lg shadow-xl p-8 space-y-6"
    >
      <h2 id="registerTitle" class="text-3xl font-bold text-center mb-8">Crear cuenta</h2>

      <Input
        id="username"
        label="Account number"
        type="text"
        placeholder="Escribe tu account number"
        required
      />

      <Input
        id="email"
        label="Email"
        type="email"
        placeholder="you@email.com"
        required
      />

      <Input
        id="password"
        label="Password"
        type="password"
        placeholder="••••••••"
        required
      />

      <Input
        id="confirmPassword"
        label="Confirmar contraseña"
        type="password"
        placeholder="••••••••"
        required
      />

      <ErrorMessage
        message={error}
        visible={!!error}
      />

      <SubmitBtn label="REGISTRARSE" id="registerBtn" />

      <p id="hasAccountText" class="mt-6 text-center text-sm text-gray-400">
        ¿Ya tenes una cuenta?
        <a
          href="/login"
          id="loginLink"
          class="text-yellow-500 hover:text-yellow-400 font-medium"
          >Ingresar</a
        >
      </p>
    </form>
  </section>

  <script>
    import { useAuth } from "@hooks/useAuth";
    import { t, getStoredLanguage } from "../i18n/translations";

    const lang = getStoredLanguage();

    // Apply translations
    const registerTitle = document.getElementById("registerTitle");
    if (registerTitle) registerTitle.textContent = t("auth.createAccount", lang);

    const registerBtn = document.getElementById("registerBtn");
    if (registerBtn) registerBtn.textContent = t("auth.registerButton", lang);

    const hasAccountText = document.getElementById("hasAccountText");
    const loginLink = document.getElementById("loginLink");
    if (hasAccountText && loginLink) {
      hasAccountText.childNodes[0].textContent = t("auth.hasAccount", lang) + " ";
      loginLink.textContent = t("auth.login", lang);
    }

    const form = document.getElementById("registerForm") as HTMLFormElement & {
      username: HTMLInputElement;
      email: HTMLInputElement;
      password: HTMLInputElement;
    };

    form?.addEventListener("submit", async (e) => {
      e.preventDefault();

      const username = form.username.value;
      const email = form.email.value;
      const password = form.password.value;

      const res = await useAuth("register", { username, email, password });
      if (res.success) window.location.href = "/create-character";
      else alert(res.error);
    });
  </script>
</Layout>

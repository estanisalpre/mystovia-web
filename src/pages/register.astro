---
import Layout from "../layouts/Layout.astro";

import Input from "@ui/Input.astro";
import ErrorMessage from "@ui/ErrorMessage.astro";
import SubmitBtn from "@ui/SubmitBtn.astro";

let error = "";
---

<Layout title="Registrarse | Mystovia">
  <section
    class="grow z-100 flex items-center justify-center min-h-screen py-12 px-4"
  >
    <form
      id="registerForm"
      class="max-w-md w-full backdrop-blur-md border border-white/30 bg-black/30 rounded-lg shadow-xl p-8 space-y-6"
    >
      <h2 class="text-3xl font-bold text-center mb-8">Crear cuenta</h2>

      <Input
        id="username"
        label="Account number"
        type="text"
        placeholder="Escribe tu account number"
        required
      />

      <Input
        id="email"
        label="Email"
        type="email"
        placeholder="you@email.com"
        required
      />

      <Input
        id="password"
        label="Password"
        type="password"
        placeholder="Nueva contrase単a"
        required
      />

      <Input
        id="confirmPassword"
        label="Confirmar contrase単a"
        type="password"
        placeholder="Confirmar contrase単a"
        required
      />

      <ErrorMessage
        message={error}
        visible={!!error}
      />

      <SubmitBtn label="REGISTRARSE" />

      <p class="mt-6 text-center text-sm text-gray-400">
        多Ya tenes una cuenta?
        <a
          href="/login"
          class="text-yellow-500 hover:text-yellow-400 font-medium"
          >Ingresar</a
        >
      </p>
    </form>
  </section>

  <script>
    import { useAuth } from "@hooks/useAuth";

    const form = document.getElementById("registerForm") as HTMLFormElement & {
      username: HTMLInputElement;
      email: HTMLInputElement;
      password: HTMLInputElement;
    };

    form?.addEventListener("submit", async (e) => {
      e.preventDefault();

      const username = form.username.value;
      const email = form.email.value;
      const password = form.password.value;

      const res = await useAuth("register", { username, email, password });
      if (res.success) window.location.href = "/create-character";
      else alert(res.error);
    });
  </script></Layout
>

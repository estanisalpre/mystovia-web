---
import Layout from '../layouts/Layout.astro';

const API_URL = import.meta.env.PUBLIC_API_URL || 'http://localhost:3000';

let faqsData;

try {
  const response = await fetch(`${API_URL}/api/faqs`);
  faqsData = await response.json();
} catch (error) {
  console.error('Error fetching FAQs:', error);
  faqsData = { categories: [] };
}

const { categories } = faqsData;
---

<Layout title="Preguntas Frecuentes">
  <section class="page-container">
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold mb-4">❓ Preguntas Frecuentes</h1>
      <p class="text-lg text-base-content/70">
        Encuentra respuestas a las preguntas más comunes
      </p>
    </div>

    {categories.length === 0 ? (
      <div class="text-center py-12">
        <p class="text-lg text-base-content/70">No hay FAQs disponibles aún.</p>
      </div>
    ) : (
      <div class="space-y-8">
        {categories.map((category: any) => (
          <div>
            <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
              <span class="badge badge-primary badge-lg">{category.name}</span>
            </h2>

            {category.faqs.length === 0 ? (
              <p class="text-base-content/60">No hay preguntas en esta categoría.</p>
            ) : (
              <div class="join join-vertical w-full">
                {category.faqs.map((faq: any) => (
                  <div class="collapse collapse-arrow join-item border border-base-300 bg-base-100">
                    <input type="radio" name={`faq-category-${category.id}`} />
                    <div class="collapse-title text-lg font-medium">
                      {faq.question}
                    </div>
                    <div class="collapse-content">
                      <p class="pt-2 text-base-content/80">{faq.answer}</p>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        ))}
      </div>
    )}

    <div class="alert alert-info mt-8">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <span>
        ¿No encuentras lo que buscas? <a href="/support" class="link link-hover font-semibold">Contacta con soporte</a>
      </span>
    </div>
  </section>
</Layout>

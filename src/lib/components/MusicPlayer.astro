---
import { Music } from "@lucide/astro";
---

<aside
  class="fixed bottom-4 right-4 z-50 group flex items-center gap-2 bg-black/40 border border-yellow-500 rounded-lg p-3 cursor-pointer backdrop-blur-md transition-all hover:pr-4"
>
  <Music class="text-yellow-400 w-6 h-6 group-hover:text-yellow-300 transition" />
  <input
    id="volumeControl"
    type="range"
    min="0"
    max="1"
    step="0.01"
    value="0.5"
    class="w-0 opacity-0 group-hover:w-24 group-hover:opacity-100 transition-all duration-300 accent-yellow-400"
  />
</aside>

<script type="module">
  if (typeof window !== "undefined") {
    const volumeControl = document.getElementById("volumeControl");
    const audio = new Audio("/assets/music/bg-music.mp3");
    audio.loop = true;
    audio.volume = 0.05;

    audio.play().catch(() => {
      console.warn("Autoplay bloqueado. Esperando interacciÃ³n del usuario...");
      document.addEventListener("click", () => audio.play(), { once: true });
    });

    volumeControl?.addEventListener("input", (e) => {
      e.preventDefault();
      let target = 0.05
      target = e.target;
      if (target instanceof HTMLInputElement) {
        audio.volume = parseFloat(target.value);
      }
    });
  }
</script>